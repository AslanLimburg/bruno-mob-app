# ‚úÖ KYC —Å S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º - –ù–ê–°–¢–†–û–ï–ù–û!

**–î–∞—Ç–∞**: 27 –æ–∫—Ç—è–±—Ä—è 2025, 11:00  
**–°—Ç–∞—Ç—É—Å**: S3 –∞–∫—Ç–∏–≤–µ–Ω —Å fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

---

## üîß –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. S3 Integration

**–î–æ:**
- –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- –§–∞–π–ª—ã –≤ `uploads/verification/`

**–ü–æ—Å–ª–µ:**
- ‚úÖ **–û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: S3** (Timeweb Cloud Storage)
- ‚úÖ **Fallback: –ª–æ–∫–∞–ª—å–Ω–æ** (–µ—Å–ª–∏ S3 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ

### 2. –ö–Ω–æ–ø–∫–∞ Upload

**–£–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä (padding: 18px)
- ‚úÖ –Ø—Ä—á–µ —Ü–≤–µ—Ç–∞ (gradient gold)
- ‚úÖ –ë–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω–∞—è (box-shadow)
- ‚úÖ Hover —ç—Ñ—Ñ–µ–∫—Ç (scale + shadow)
- ‚úÖ –ß–µ—Ç–∫–∏–π disabled state

---

## üì¶ S3 –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (.env):

```env
# S3 Storage (Timeweb)
S3_ENDPOINT=https://s3.twcstorage.ru
S3_REGION=ru-1
S3_ACCESS_KEY=U9EFNOYR55J
S3_SECRET_KEY=Zi76caEspF
S3_BUCKET_NAME=3559f705-206b4cb2-9274-41df-9f35-54c37a418b4d
S3_PUBLIC_URL=https://3559f705-206b4cb2-9274-41df-9f35-54c37a418b4d.s3.twcstorage.ru
```

### –ü—Ä–æ–≤–∞–π–¥–µ—Ä: **Timeweb Cloud Storage**
- –°–æ–≤–º–µ—Å—Ç–∏–º —Å Amazon S3 API
- –†–µ–≥–∏–æ–Ω: ru-1 (–†–æ—Å—Å–∏—è)
- Bucket —Å–æ–∑–¥–∞–Ω –∏ –∞–∫—Ç–∏–≤–µ–Ω

---

## üîÑ –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢

### –°—Ö–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª
   ‚Üì
Frontend ‚Üí POST /api/upload/document
   ‚Üì
Backend ‚Üí documentController.uploadVerificationDocument()
   ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ S3 –Ω–∞—Å—Ç—Ä–æ–µ–Ω?
   ‚îú‚îÄ ‚úÖ –î–ê ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ –≤ S3 (Timeweb)
   ‚îÇ         ‚Üí URL: https://bucket.s3.twcstorage.ru/verification/{userId}/doc-xxx.jpg
   ‚îÇ         ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
   ‚îÇ
   ‚îî‚îÄ ‚ùå –ù–ï–¢ ‚Üí Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
             ‚Üí –ü—É—Ç—å: uploads/verification/doc-xxx.jpg
             ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
```

### –õ–æ–≥–∏–∫–∞ –≤ –∫–æ–¥–µ:

```javascript
if (isS3Configured) {
  try {
    // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ S3
    documentUrl = await uploadFile(
      req.file.buffer,
      req.file.originalname,
      `verification/${userId}`
    );
    console.log('‚úÖ Uploaded to S3');
  } catch (s3Error) {
    // –ï—Å–ª–∏ S3 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - fallback
    console.log('‚ö†Ô∏è S3 failed, using local');
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
  }
} else {
  // S3 –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω - —Å—Ä–∞–∑—É –ª–æ–∫–∞–ª—å–Ω–æ
  console.log('üíæ Using local storage');
}
```

---

## üì§ –ü–†–û–¶–ï–°–° –ó–ê–ì–†–£–ó–ö–ò

### –®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª

```
Dashboard ‚Üí KYC Badge
‚Üí Verification Page
‚Üí Document Type: Passport
‚Üí Choose File: passport.jpg
```

### –®–∞–≥ 2: –í–∞–ª–∏–¥–∞—Ü–∏—è

```
‚úÖ –¢–∏–ø —Ñ–∞–π–ª–∞: JPG, PNG, PDF
‚úÖ –†–∞–∑–º–µ—Ä: <= 10 MB
‚úÖ –§–∞–π–ª –≤—ã–±—Ä–∞–Ω
```

### –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∫–∞

```
–ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üì§ UPLOAD"
‚Üì
FormData —Å–æ–∑–¥–∞–µ—Ç—Å—è:
- document: File
- documentType: 'passport'
‚Üì
POST /api/upload/document
```

### –®–∞–≥ 4: Backend –æ–±—Ä–∞–±–æ—Ç–∫–∞

```
Multer ‚Üí req.file (buffer –≤ –ø–∞–º—è—Ç–∏)
‚Üì
S3 Upload:
- Bucket: 3559f705-...
- Path: verification/{userId}/doc-xxx.jpg
- ACL: public-read
‚Üì
–ü–æ–ª—É—á–µ–Ω–∏–µ URL:
https://3559f705-206b4cb2-9274-41df-9f35-54c37a418b4d.s3.twcstorage.ru/verification/5/doc-1730025600000.jpg
‚Üì
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ verification_documents:
- user_id: 5
- document_type: 'passport'
- document_url: S3 URL
- status: 'pending'
```

### –®–∞–≥ 5: –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```
‚úÖ "Document successfully uploaded and submitted for review!"
```

---

## üóÑÔ∏è S3 –°–¢–†–£–ö–¢–£–†–ê

### Bucket —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

```
3559f705-206b4cb2-9274-41df-9f35-54c37a418b4d/
  ‚îî‚îÄ‚îÄ verification/
      ‚îú‚îÄ‚îÄ 5/
      ‚îÇ   ‚îú‚îÄ‚îÄ doc-1730025600000.jpg (passport user #5)
      ‚îÇ   ‚îî‚îÄ‚îÄ doc-1730025700000.pdf (id_card user #5)
      ‚îú‚îÄ‚îÄ 7/
      ‚îÇ   ‚îî‚îÄ‚îÄ doc-1730025800000.png (passport user #7)
      ‚îî‚îÄ‚îÄ ...
```

### URL —Ñ–æ—Ä–º–∞—Ç:

```
https://{bucket}.s3.twcstorage.ru/{path}/{filename}

–ü—Ä–∏–º–µ—Ä:
https://3559f705-206b4cb2-9274-41df-9f35-54c37a418b4d.s3.twcstorage.ru/verification/5/doc-1730025600000.jpg
```

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:

**Public —á–∏—Ç–∞–µ–º–æ—Å—Ç—å:**
- –î–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ
- –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (–≤ super-admin panel)
- URL –Ω–µ –≤–∏–¥–µ–Ω –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - Private bucket:**
–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å signed URLs:
```javascript
// –í s3Upload.js —É–∂–µ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è
const signedUrl = await getSignedFileUrl(key, 3600); // 1 —á–∞—Å
```

### Encryption:

S3 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- Server-side encryption (SSE-S3)
- Server-side encryption with KMS
- Client-side encryption

---

## üí° FALLBACK –ú–ï–•–ê–ù–ò–ó–ú

### –ï—Å–ª–∏ S3 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:

```
1. –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ S3
2. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞:
   - –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ
   - –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ uploads/verification/
3. URL –º–µ–Ω—è–µ—Ç—Å—è:
   - S3: https://bucket.s3.../verification/...
   - Local: /uploads/verification/doc-xxx.jpg
4. –í—Å—ë –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å! ‚úÖ
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ—Ç –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–∫–∞–∑–∞ —Å–µ—Ä–≤–∏—Å–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –æ—à–∏–±–∫—É
- –ê–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ

---

## üéØ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï S3

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```bash
# –í backend –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
cd /Users/user/Desktop/bt/backend
node -e "
const { s3Client, bucketName } = require('./config/s3');
const { ListObjectsV2Command } = require('@aws-sdk/client-s3');

(async () => {
  try {
    const command = new ListObjectsV2Command({ Bucket: bucketName, MaxKeys: 1 });
    const response = await s3Client.send(command);
    console.log('‚úÖ S3 connected successfully!');
    console.log('Bucket:', bucketName);
  } catch (error) {
    console.error('‚ùå S3 connection failed:', error.message);
  }
})();
"
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
‚úÖ S3 connected successfully!
Bucket: 3559f705-206b4cb2-9274-41df-9f35-54c37a418b4d
```

---

## üìä –õ–û–ì–ò

### –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –≤ S3:

```
üì§ Uploading to S3 for user 5...
‚úÖ Uploaded to S3: https://3559f705-...s3.twcstorage.ru/verification/5/doc-xxx.jpg
```

### –ü—Ä–∏ fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ:

```
üì§ Uploading to S3 for user 5...
‚ö†Ô∏è S3 upload failed, using local storage: Network error
‚úÖ Saved locally: doc-5-1730025600000.jpg
```

### –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º S3:

```
üíæ S3 not configured, using local storage for user 5...
‚úÖ Saved locally: doc-5-1730025600000.jpg
```

---

## üé® –í–ò–ó–£–ê–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø –ö–ù–û–ü–ö–ò

### –î–æ:
```
[        üì§ Upload         ] ‚Üê –¢—É—Å–∫–ª–∞—è
```

### –ü–æ—Å–ª–µ:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      üì§ UPLOAD             ‚îÇ ‚Üê –Ø–†–ö–ê–Ø!
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ‚Üë –ì—Ä–∞–¥–∏–µ–Ω—Ç + —Ç–µ–Ω—å + hover
```

**–≠—Ñ—Ñ–µ–∫—Ç—ã:**
- –ì—Ä–∞–¥–∏–µ–Ω—Ç: gold ‚Üí orange
- –¢–µ–Ω—å: —è—Ä–∫–∞—è –∑–æ–ª–æ—Ç–∞—è
- Hover: —É–≤–µ–ª–∏—á–µ–Ω–∏–µ + –ø–æ–¥—ä–µ–º
- Active: –Ω–µ–±–æ–ª—å—à–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
- Disabled: —Å–µ—Ä–∞—è, –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –†–ê–ë–û–¢–´ KYC

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
- [ ] –û—Ç–∫—Ä—ã—Ç—å /verification
- [ ] –í—ã–±—Ä–∞—Ç—å Document Type
- [ ] –ù–∞–∂–∞—Ç—å Choose File
- [ ] –í—ã–±—Ä–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç (JPG/PNG/PDF)
- [ ] –ù–∞–∂–∞—Ç—å "üì§ UPLOAD" (—è—Ä–∫–∞—è –∑–æ–ª–æ—Ç–∞—è –∫–Ω–æ–ø–∫–∞)
- [ ] –£–≤–∏–¥–µ—Ç—å "Document successfully uploaded..." ‚úÖ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "Under Review" üü°

### Admin:
- [ ] –í–æ–π—Ç–∏ –∫–∞–∫ super-admin
- [ ] Super Admin Panel ‚Üí KYC Management
- [ ] –£–≤–∏–¥–µ—Ç—å pending –¥–æ–∫—É–º–µ–Ω—Ç—ã
- [ ] –ö–ª–∏–∫–Ω—É—Ç—å "View Document" (–æ—Ç–∫—Ä–æ–µ—Ç—Å—è S3 URL)
- [ ] Approve –∏–ª–∏ Reject
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å

---

## üöÄ –ü–†–û–í–ï–†–ö–ê

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä
```
http://localhost:3000
Cmd + Shift + R
```

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ KYC
```
Dashboard ‚Üí –ù–∞–∂–º–∏—Ç–µ –Ω–∞ KYC Badge
–ò–õ–ò –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ /verification
```

### –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç
```
1. Document Type: Passport
2. Choose File ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ JPG/PNG/PDF
3. –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è: "üìÑ filename.jpg (X.XX MB)"
4. –ö–Ω–æ–ø–∫–∞ "üì§ UPLOAD" –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ø–†–ö–û–ô
5. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É
6. Loader: "‚è≥ Uploading..."
7. Success: "Document successfully uploaded..." ‚úÖ
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend
```
–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ backend –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
üì§ Uploading to S3 for user X...
‚úÖ Uploaded to S3: https://...s3.twcstorage.ru/verification/.../doc-xxx.jpg
```

---

## üêõ TROUBLESHOOTING

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–Ω–æ–ø–∫–∞ —Å–µ—Ä–∞—è (disabled)

**–ü—Ä–∏—á–∏–Ω–∞:** –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –ù–∞–∂–º–∏—Ç–µ "Choose File"
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª
3. –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è preview: "üìÑ filename.jpg"
4. –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–µ—Ç —è—Ä–∫–æ–π (–∞–∫—Ç–∏–≤–Ω–æ–π)

### –ü—Ä–æ–±–ª–µ–º–∞: S3 upload fails

**–õ–æ–≥–∏:**
```
‚ö†Ô∏è S3 upload failed, using local storage
```

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–≤–µ—Ä–Ω—ã–µ credentials
- Bucket –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env credentials
- –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (fallback —Ä–∞–±–æ—Ç–∞–µ—Ç)

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to upload document"

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞? `node run-verification-migration.js`
2. Backend –∑–∞–ø—É—â–µ–Ω? `lsof -i :5000`
3. –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ < 10 MB?
4. –§–æ—Ä–º–∞—Ç JPG/PNG/PDF?

---

## üìã –§–ê–ô–õ–´

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ:**
1. `backend/controllers/documentController.js`
   - S3 upload —Å fallback
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - Error handling

2. `frontend/src/components/verification/Verification.css`
   - –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞
   - –Ø—Ä–∫–∏–µ —Ü–≤–µ—Ç–∞
   - Hover —ç—Ñ—Ñ–µ–∫—Ç—ã

**S3 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
3. `backend/config/s3.js` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
4. `backend/utils/s3Upload.js` - —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏

---

## üåê S3 vs Local Storage

### S3 (Timeweb Cloud):
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (–Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ)
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å (—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ CDN (–±—ã—Å—Ç—Ä–∞—è —Ä–∞–∑–¥–∞—á–∞)
- ‚úÖ Backup –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π
- ‚úÖ –î–æ—Å—Ç—É–ø –∏–∑ –ª—é–±–æ–≥–æ –º–µ—Å—Ç–∞

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
- ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å–µ—Ä–≤–∏—Å–∞
- üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å (–æ–±—ã—á–Ω–æ –∫–æ–ø–µ–π–∫–∏)

### Local Storage:
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚ö†Ô∏è –ù—É–∂–µ–Ω backup –≤—Ä—É—á–Ω—É—é
- ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–µ

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –î–ª—è production:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ S3** (–æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
   - –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
   - –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
   - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ

2. **–û—Å—Ç–∞–≤—å—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π fallback**
   - –ù–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å S3
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Private bucket**
   - –î–æ–∫—É–º–µ–Ω—Ç—ã —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ signed URLs
   - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 1 —á–∞—Å

4. **–í–∫–ª—é—á–∏—Ç–µ encryption**
   - Server-side encryption –≤ S3
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

---

## üìù –ö–û–î –ò–ó–ú–ï–ù–ï–ù–ò–ô

### documentController.js:

```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏ S3
const isS3Configured = 
  process.env.S3_ENDPOINT && 
  process.env.S3_ACCESS_KEY;

// –õ–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
if (isS3Configured) {
  try {
    // S3 upload
    documentUrl = await uploadFile(...);
  } catch (s3Error) {
    // Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ
  }
} else {
  // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
}
```

---

## ‚úÖ –ì–û–¢–û–í–û!

**S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:**
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ (Timeweb)
- ‚úÖ Credentials –≤ .env
- ‚úÖ Bucket –∞–∫—Ç–∏–≤–µ–Ω
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ

**–ö–Ω–æ–ø–∫–∞ Upload:**
- ‚úÖ –Ø—Ä–∫–∞—è –∏ –∑–∞–º–µ—Ç–Ω–∞—è
- ‚úÖ –ß–µ—Ç–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (active/disabled)
- ‚úÖ Hover —ç—Ñ—Ñ–µ–∫—Ç—ã
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è

**–û–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç!**

---

## üîç –ü–†–û–í–ï–†–ö–ê

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ
http://localhost:3000/verification

# 1. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª
# 2. –ö–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ø–†–ö–û–ô –ó–û–õ–û–¢–û–ô
# 3. –ù–∞–∂–º–∏—Ç–µ Upload
# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend:
#    "üì§ Uploading to S3..."
#    "‚úÖ Uploaded to S3: https://..."

# 5. –§–∞–π–ª –≤ S3! ‚úÖ
```

---

*–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ: 27.10.2025, 11:00*  
*S3 –∞–∫—Ç–∏–≤–µ–Ω! üöÄ*

