# 📖 Пошаговая инструкция: Как настроить и запустить deploy-to-timeweb.sh

**Для:** Начинающих  
**Время:** 15 минут  
**Сложность:** Очень просто! ⭐

---

## 🎯 ЧТО МЫ БУДЕМ ДЕЛАТЬ

1. Откроем файл `deploy-to-timeweb.sh` в текстовом редакторе
2. Изменим 2 строки (ваш user и host)
3. Сохраним
4. Запустим скрипт из терминала
5. Подождем пока всё загрузится
6. Готово! ✅

**ПОЕХАЛИ!** 🚀

---

## 📍 ШАГ 1: ОТКРОЙТЕ ТЕРМИНАЛ

### Способ 1: Через Spotlight

```
1. Нажмите: Cmd + Space (пробел)
2. Появится строка поиска
3. Напечатайте: Terminal
4. Нажмите Enter
5. Откроется окно Terminal ✅
```

### Способ 2: Через Finder

```
1. Finder → Applications (Программы)
2. Utilities (Утилиты)
3. Terminal
4. Двойной клик
5. Откроется окно Terminal ✅
```

**Вы увидите:**
```
Last login: ...
user@MacBook-Pro ~ %
```

---

## 📍 ШАГ 2: ПЕРЕЙДИТЕ В ПРОЕКТ

### В терминале напечатайте (или скопируйте):

```bash
cd /Users/user/Desktop/bt
```

### Нажмите: Enter

**Вы увидите:**
```
user@MacBook-Pro bt %
```

### Проверьте что файл есть:

```bash
ls -la deploy-to-timeweb.sh
```

### Нажмите: Enter

**Вы увидите:**
```
-rwxr-xr-x  1 user  staff  5234 Oct 27 12:00 deploy-to-timeweb.sh
```

✅ Отлично! Файл найден!

---

## 📍 ШАГ 3: ОТКРОЙТЕ ФАЙЛ В РЕДАКТОРЕ

### Вариант A: Nano (в терминале - РЕКОМЕНДУЮ!)

**Напечатайте:**
```bash
nano deploy-to-timeweb.sh
```

**Нажмите: Enter**

**Вы увидите:**
```
#!/bin/bash

# ╔═══════════════════════════════════════════════╗
# ║    Bruno Token - Deploy to Timeweb Script     ║
# ╚═══════════════════════════════════════════════╝

# НАСТРОЙКИ - ИЗМЕНИТЕ ПОД СВОЙ СЕРВЕР!
SERVER_USER="your-user"              # <-- ИЗМЕНИТЕ ЭТУ СТРОКУ
SERVER_HOST="your-server.timeweb.ru" # <-- И ЭТУ СТРОКУ
SERVER_PATH="/var/www/brunotoken"
SERVER_PORT="22"

...
```

**Курсор будет мигать в начале файла.**

---

### Вариант B: TextEdit (визуально)

```
1. Finder → Desktop → bt
2. Найдите файл: deploy-to-timeweb.sh
3. Правой кнопкой → Открыть с помощью → TextEdit
4. Откроется в редакторе
```

---

## 📍 ШАГ 4: ИЗМЕНИТЕ 2 СТРОКИ

### Если используете Nano:

**1. Найдите строку 11 (SERVER_USER):**

Используйте стрелки ↓ ↓ ↓ чтобы перейти вниз до строки:
```
SERVER_USER="your-user"              # <-- ИЗМЕНИТЕ ЭТУ СТРОКУ
```

**2. Измените "your-user" на ваш реальный user:**

- Нажмите: Ctrl+W (поиск)
- Напечатайте: SERVER_USER
- Нажмите: Enter
- Курсор перейдет на эту строку
- Используйте стрелки → → → чтобы дойти до `"your-user"`
- Нажмите: Ctrl+K (удалить до конца строки)
- Напечатайте новое значение:
  ```
  SERVER_USER="ваш-реальный-user"
  ```

**Например:**
```bash
# Было:
SERVER_USER="your-user"

# Стало:
SERVER_USER="u1234567"
```

**3. Найдите строку 12 (SERVER_HOST):**

- Нажмите стрелку ↓ (на следующую строку)
- Увидите:
  ```
  SERVER_HOST="your-server.timeweb.ru"
  ```
- Используйте стрелки → → → чтобы дойти до `"your-server..."`
- Нажмите: Ctrl+K (удалить до конца строки)
- Напечатайте новое значение:
  ```
  SERVER_HOST="ваш-сервер.timeweb.ru"
  ```

**Например:**
```bash
# Было:
SERVER_HOST="your-server.timeweb.ru"

# Стало:
SERVER_HOST="srv123456.timeweb.ru"
```

**4. Сохраните файл:**

- Нажмите: Ctrl+X
- Появится вопрос: "Save modified buffer?"
- Напечатайте: Y (yes)
- Нажмите: Enter
- Файл сохранен! ✅

**Вы вернетесь в терминал:**
```
user@MacBook-Pro bt %
```

---

### Если используете TextEdit:

**1. Найдите строки 11-12:**

Прокрутите вниз до:
```bash
SERVER_USER="your-user"
SERVER_HOST="your-server.timeweb.ru"
```

**2. Измените:**

- Выделите `your-user`
- Удалите
- Напечатайте ваш реальный user (например: `u1234567`)

- Выделите `your-server.timeweb.ru`
- Удалите
- Напечатайте ваш реальный сервер (например: `srv123456.timeweb.ru`)

**3. Сохраните:**

- Cmd+S
- Закройте TextEdit

---

## 📍 ШАГ 5: УЗНАЙТЕ ВАШ SSH ДОСТУП

### Где найти в панели Timeweb:

```
1. Откройте браузер
2. Перейдите: https://timeweb.com/ru/my/
3. Войдите в аккаунт
4. Раздел: Серверы
5. Выберите ваш сервер
6. Вкладка: SSH/SFTP доступ

Увидите:
  Хост: srv123456.timeweb.ru
  Порт: 22
  Логин: u1234567
  Пароль: ваш-пароль (или установите)
```

### Запишите:

```
Логин (USER): u1234567
Хост (HOST): srv123456.timeweb.ru
Пароль: ваш-пароль
```

**Это нужно для строк в скрипте!**

---

## 📍 ШАГ 6: ПРОВЕРЬТЕ ЧТО ИЗМЕНИЛИ ПРАВИЛЬНО

### В терминале:

```bash
head -15 deploy-to-timeweb.sh | grep SERVER
```

**Нажмите: Enter**

**Вы должны увидеть:**
```
SERVER_USER="u1234567"              # ← Ваш реальный user
SERVER_HOST="srv123456.timeweb.ru"  # ← Ваш реальный сервер
SERVER_PATH="/var/www/brunotoken"
SERVER_PORT="22"
```

**Если видите "your-user" или "your-server" - вернитесь к Шагу 4!**

**Если видите ваши реальные данные - отлично! Продолжаем!** ✅

---

## 📍 ШАГ 7: ЗАПУСТИТЕ СКРИПТ

### В терминале напечатайте:

```bash
./deploy-to-timeweb.sh
```

**Нажмите: Enter**

---

## 🎬 ЧТО БУДЕТ ПРОИСХОДИТЬ

### Вы увидите такую последовательность:

```
╔═══════════════════════════════════════════════════════════════════╗
║                                                                   ║
║         🚀 Bruno Token - Deploy to Timeweb                        ║
║                                                                   ║
╚═══════════════════════════════════════════════════════════════════╝

═══════════════════════════════════════════════════════════════════
1/7: Проверка SSH соединения...
═══════════════════════════════════════════════════════════════════
```

**ТУТ ПОПРОСИТ ПАРОЛЬ:**
```
u1234567@srv123456.timeweb.ru's password:
```

**Напечатайте ваш SSH пароль и нажмите Enter**
(пароль не будет виден - это нормально!)

```
✅ SSH соединение установлено

═══════════════════════════════════════════════════════════════════
2/7: Building frontend...
═══════════════════════════════════════════════════════════════════
Creating an optimized production build...
Compiled successfully!

File sizes after gzip:

  52.31 KB  build/static/js/main.abc123.js
  1.23 KB   build/static/css/main.def456.css

✅ Frontend build completed

═══════════════════════════════════════════════════════════════════
3/7: Creating deployment archive...
═══════════════════════════════════════════════════════════════════
✅ Archive created: bruno-deploy-20251027-120000.tar.gz (15M)

═══════════════════════════════════════════════════════════════════
4/7: Uploading to server...
═══════════════════════════════════════════════════════════════════
u1234567@srv123456.timeweb.ru's password: ← СНОВА ПАРОЛЬ
bruno-deploy-20251027-120000.tar.gz    100%   15MB   1.2MB/s   00:12
✅ Archive uploaded to server

═══════════════════════════════════════════════════════════════════
5/7: Installing on server...
═══════════════════════════════════════════════════════════════════
📦 Extracting archive...
📁 Creating project directory...
🔄 Copying files...
🗑️  Cleaning up...
✅ Files installed!
✅ Installation completed

═══════════════════════════════════════════════════════════════════
6/7: Installing dependencies...
═══════════════════════════════════════════════════════════════════
📦 Installing npm packages...
added 245 packages from 123 contributors in 45.2s
✅ Dependencies installed!
✅ Dependencies installed

═══════════════════════════════════════════════════════════════════
7/7: Starting application...
═══════════════════════════════════════════════════════════════════
🔄 Restarting existing process...
[PM2] Applying action restartProcessId on app [bruno-token-backend]
[PM2] [bruno-token-backend] ✓

✅ Application started!
┌─────┬────────────────────────┬─────┬──────┬──────┐
│ id  │ name                   │ mode│ ↺    │ status│
├─────┼────────────────────────┼─────┼──────┼──────┤
│ 0   │ bruno-token-backend    │ fork│ 1    │ online│
└─────┴────────────────────────┴─────┴──────┴──────┘
✅ Application running!

╔═══════════════════════════════════════════════════════════════════╗
║                                                                   ║
║         ✅ DEPLOY COMPLETED SUCCESSFULLY!                         ║
║                                                                   ║
╚═══════════════════════════════════════════════════════════════════╝

🌐 Your app is now live at:
   https://srv123456.timeweb.ru

📊 Check status:
   ssh u1234567@srv123456.timeweb.ru 'pm2 logs bruno-token-backend --lines 20'

🔄 To deploy again:
   ./deploy-to-timeweb.sh

✅ Deploy finished! 🎉
```

**ВСЕГО ПОПРОСИТ ПАРОЛЬ 2 РАЗА!**

---

## 📸 ВИЗУАЛЬНАЯ ИНСТРУКЦИЯ

### ЭКРАН 1: Терминал (начало)

```
┌─────────────────────────────────────────────────┐
│ Last login: Mon Oct 27 12:00:00 on ttys001     │
│                                                 │
│ user@MacBook-Pro ~ %                            │ ← Курсор здесь
└─────────────────────────────────────────────────┘
```

**ВЫ ПЕЧАТАЕТЕ:**
```
cd /Users/user/Desktop/bt
```

**НАЖИМАЕТЕ: Enter**

---

### ЭКРАН 2: Открытие файла

```
┌─────────────────────────────────────────────────┐
│ user@MacBook-Pro bt %                           │ ← Курсор здесь
└─────────────────────────────────────────────────┘
```

**ВЫ ПЕЧАТАЕТЕ:**
```
nano deploy-to-timeweb.sh
```

**НАЖИМАЕТЕ: Enter**

---

### ЭКРАН 3: Редактор Nano

```
┌─────────────────────────────────────────────────────┐
│  GNU nano 2.0.6      deploy-to-timeweb.sh          │
├─────────────────────────────────────────────────────┤
│#!/bin/bash                                          │
│                                                     │
│# ╔═══════════════════════════════════════════════╗ │
│# ║    Bruno Token - Deploy to Timeweb Script     ║ │
│# ╚═══════════════════════════════════════════════╝ │
│                                                     │
│# НАСТРОЙКИ - ИЗМЕНИТЕ ПОД СВОЙ СЕРВЕР!             │
│SERVER_USER="your-user"         # <-- ИЗМЕНИТЕ ЭТУ  │ ← Строка 11
│SERVER_HOST="your-server.ru"    # <-- И ЭТУ СТРОКУ  │ ← Строка 12
│SERVER_PATH="/var/www/brunotoken"                   │
│SERVER_PORT="22"                                    │
│                                                     │
│...                                                  │
├─────────────────────────────────────────────────────┤
│^G Get Help  ^O WriteOut  ^R Read File  ^X Exit     │
└─────────────────────────────────────────────────────┘
```

---

### ЭКРАН 4: Поиск строки

**НАЖИМАЕТЕ: Ctrl+W** (поиск)

**Внизу появится:**
```
Search: _
```

**ПЕЧАТАЕТЕ:**
```
SERVER_USER
```

**НАЖИМАЕТЕ: Enter**

**Курсор перепрыгнет на строку:**
```
SERVER_USER="your-user"         # <-- ИЗМЕНИТЕ ЭТУ
            ↑ курсор здесь
```

---

### ЭКРАН 5: Редактирование строки 11

**Используйте стрелки →→→ чтобы дойти до кавычек:**
```
SERVER_USER="your-user"
            ↑ курсор должен быть здесь (после ")
```

**Выделите текст "your-user":**
- Стрелка → пока не дойдете до `y` в `your`
- Нажмите: Ctrl+K (удалит до конца строки)

**Теперь печатайте ВАШ РЕАЛЬНЫЙ USER:**
```
SERVER_USER="u1234567"
```

**Например, если ваш SSH user: u1234567**

---

### ЭКРАН 6: Редактирование строки 12

**Нажмите стрелку ↓ (вниз на следующую строку)**

**Увидите:**
```
SERVER_HOST="your-server.timeweb.ru"
```

**Повторите то же:**
- Стрелки →→→ до кавычек
- Стрелка → до `y`
- Ctrl+K (удалить)
- Напечатайте ВАШ РЕАЛЬНЫЙ СЕРВЕР:
  ```
  SERVER_HOST="srv123456.timeweb.ru"
  ```

**Например, если ваш сервер: srv123456.timeweb.ru**

---

### ЭКРАН 7: Сохранение

**Результат должен быть:**
```
SERVER_USER="u1234567"
SERVER_HOST="srv123456.timeweb.ru"
SERVER_PATH="/var/www/brunotoken"
SERVER_PORT="22"
```

**СОХРАНИТЕ:**

1. Нажмите: **Ctrl+X** (выход)
2. Появится вопрос: **"Save modified buffer? (Y/N)"**
3. Напечатайте: **Y**
4. Появится: **"File Name to Write: deploy-to-timeweb.sh"**
5. Нажмите: **Enter**

**Вы вернетесь в терминал:**
```
user@MacBook-Pro bt %
```

✅ **Файл сохранен!**

---

## 📍 ШАГ 8: ЗАПУСК СКРИПТА

### В терминале напечатайте:

```bash
./deploy-to-timeweb.sh
```

**Нажмите: Enter**

---

## 🔐 ШАГ 9: ВВОД ПАРОЛЕЙ

### Скрипт попросит пароль 2 РАЗА:

**ПЕРВЫЙ РАЗ (проверка SSH):**
```
u1234567@srv123456.timeweb.ru's password: _
```

**Напечатайте ваш SSH пароль**
(текст НЕ будет виден - это нормально!)
**Нажмите: Enter**

---

**ВТОРОЙ РАЗ (загрузка файлов):**
```
u1234567@srv123456.timeweb.ru's password: _
```

**Снова напечатайте пароль**
**Нажмите: Enter**

---

## ⏳ ШАГ 10: ОЖИДАНИЕ

### Скрипт будет работать ~10 минут:

**Вы увидите прогресс:**
```
1/7: ✅
2/7: Building... (2 мин)
3/7: Archive... (10 сек)
4/7: Uploading... (5-10 мин) ← САМОЕ ДОЛГОЕ
5/7: Installing... (30 сек)
6/7: Dependencies... (3 мин)
7/7: Starting... (10 сек)

✅ DEPLOY COMPLETED!
```

**Пока ждете - можете:**
- ☕ Выпить кофе
- 📱 Проверить телефон
- 📚 Почитать документацию

---

## ✅ ШАГ 11: ПРОВЕРКА

### После завершения скрипт покажет:

```
╔═══════════════════════════════════════════════════════════════════╗
║         ✅ DEPLOY COMPLETED SUCCESSFULLY!                         ║
╚═══════════════════════════════════════════════════════════════════╝

🌐 Your app is now live at:
   https://srv123456.timeweb.ru
```

### Откройте в браузере:

```
https://ваш-сервер.timeweb.ru
```

**Должен открыться ваш сайт!** 🎉

---

## 🗄️ ШАГ 12: МИГРАЦИИ БАЗЫ ДАННЫХ

### Подключитесь по SSH:

**В терминале:**
```bash
ssh u1234567@srv123456.timeweb.ru
```

**Введите пароль, нажмите Enter**

**Вы окажетесь на сервере:**
```
u1234567@srv123456:~$
```

### Выполните миграции:

**Напечатайте:**
```bash
cd /var/www/brunotoken/backend
```
**Enter**

**Напечатайте:**
```bash
node run-verification-migration.js
```
**Enter**

**Должно быть:**
```
✅ Verification documents table created!
```

**Напечатайте:**
```bash
node run-vector-migration.js
```
**Enter**

**Должно быть:**
```
✅ Vector Destiny tables created!
```

**Напечатайте:**
```bash
pm2 logs bruno-token-backend --lines 20
```
**Enter**

**Должно быть:**
```
✅ Bruno Token API Server
Port: 5000
```

**Для выхода из логов: Ctrl+C**

**Для выхода с сервера:**
```bash
exit
```

---

## 🎉 ГОТОВО!

**Вы успешно:**
- ✅ Настроили скрипт
- ✅ Запустили deploy
- ✅ Загрузили на сервер
- ✅ Настроили базу данных
- ✅ Запустили приложение

**Сайт работает!** 🚀

---

## 📋 КРАТКАЯ ШПАРГАЛКА

```bash
# 1. Откройте терминал (Cmd+Space → Terminal)

# 2. Перейдите в проект
cd /Users/user/Desktop/bt

# 3. Откройте файл
nano deploy-to-timeweb.sh

# 4. Найдите строки (Ctrl+W → SERVER_USER → Enter)
#    Измените:
#    SERVER_USER="u1234567"
#    SERVER_HOST="srv123456.timeweb.ru"

# 5. Сохраните (Ctrl+X → Y → Enter)

# 6. Запустите
./deploy-to-timeweb.sh

# 7. Введите пароль 2 раза

# 8. Подождите ~10 минут

# 9. SSH на сервер
ssh u1234567@srv123456.timeweb.ru

# 10. Миграции
cd /var/www/brunotoken/backend
node run-verification-migration.js
node run-vector-migration.js

# 11. Проверка
pm2 logs bruno-token-backend

# 12. Выход
exit

# 13. Откройте в браузере
https://ваш-сервер.timeweb.ru
```

---

## 🆘 ПОМОЩЬ

### Если что-то не получается:

**Покажите мне:**
1. Какой шаг
2. Что видите на экране
3. Какая ошибка

**Я помогу решить!** 🤝

---

*Инструкция: DEPLOY_STEP_BY_STEP.md*  
*Дата: 27.10.2025*  
*Для начинающих ⭐*

